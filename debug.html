<!DOCTYPE html>
<html>
<head>
    <title>Debug LinguoPlayer</title>
    <style>
        body { font-family: Arial; padding: 20px; }
        .ok { color: green; }
        .error { color: red; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>–û—Ç–ª–∞–¥–∫–∞ LinguoPlayer</h1>
    
    <div id="status"></div>
    
    <button onclick="clearAll()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –í–°–ï –∫—ç—à–∏</button>
    <button onclick="testApp()">üîÑ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ</button>
    <button onclick="location.href='index.html?force='+Date.now()">‚ñ∂ –û—Ç–∫—Ä—ã—Ç—å LinguoPlayer</button>
    
    <script>
        const status = document.getElementById('status');
        
        async function clearAll() {
            status.innerHTML = '–û—á–∏—Å—Ç–∫–∞...';
            
            // –û—á–∏—â–∞–µ–º –í–°–Å
            if ('serviceWorker' in navigator) {
                const regs = await navigator.serviceWorker.getRegistrations();
                regs.forEach(r => r.unregister());
                status.innerHTML += '<br>‚úÖ Service Workers —É–¥–∞–ª–µ–Ω—ã';
            }
            
            if ('caches' in window) {
                const keys = await caches.keys();
                await Promise.all(keys.map(k => caches.delete(k)));
                status.innerHTML += '<br>‚úÖ –ö—ç—à–∏ –æ—á–∏—â–µ–Ω—ã';
            }
            
            localStorage.clear();
            sessionStorage.clear();
            status.innerHTML += '<br>‚úÖ LocalStorage –æ—á–∏—â–µ–Ω';
            
            setTimeout(() => location.reload(true), 1000);
        }
        
        async function testApp() {
            status.innerHTML = '';
            
            const tests = [
                { name: 'IndexedDB', test: () => 'indexedDB' in window },
                { name: 'Fetch API', test: () => 'fetch' in window },
                { name: 'CSS –∑–∞–≥—Ä—É–∂–µ–Ω', test: async () => {
                    try {
                        const res = await fetch('./styles.css?_=' + Date.now());
                        return res.ok;
                    } catch { return false; }
                }},
                { name: 'JS –∑–∞–≥—Ä—É–∂–µ–Ω', test: async () => {
                    try {
                        const res = await fetch('./index.js?_=' + Date.now());
                        return res.ok;
                    } catch { return false; }
                }},
                { name: 'Manifest –∑–∞–≥—Ä—É–∂–µ–Ω', test: async () => {
                    try {
                        const res = await fetch('./manifest.json?_=' + Date.now());
                        return res.ok;
                    } catch { return false; }
                }}
            ];
            
            for (const test of tests) {
                const passed = await (typeof test.test === 'function' ? test.test() : test.test);
                status.innerHTML += `${passed ? '‚úÖ' : '‚ùå'} ${test.name}<br>`;
            }
        }
        
        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = testApp;
    </script>
</body>
</html>