<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ meta-—Ç–µ–≥–∏ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <title>LinguoPlayer v1.1</title>
    
    <!-- PWA –º–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Manifest —Å –≤–µ—Ä—Å–∏–µ–π -->
    <link rel="manifest" href="./manifest.json?v=1.1">
    
    <!-- –ò–∫–æ–Ω–∫–∞ -->
    <link rel="icon" href="https://cdn-icons-png.flaticon.com/512/2903/2903544.png">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2903/2903544.png">

    <!-- –°—Ç–∏–ª–∏ —Å –≤–µ—Ä—Å–∏–µ–π -->
    <link rel="stylesheet" href="./styles.css?v=1.1">
    
    <style>
        /* –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏–Ω–ª–∞–π–Ω-—Å—Ç–∏–ª–∏ */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        #root {
            width: 100%;
            height: 100%;
        }
        
        /* –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –±–µ–ª—ã–π —Ñ–æ–Ω */
        body {
            background-color: #ffffff !important;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- JavaScript —Å –≤–µ—Ä—Å–∏–µ–π -->
    <script type="module" src="./index.js?v=1.1"></script>

    <script>
        // –Ø–í–ù–ê–Ø –û–ß–ò–°–¢–ö–ê –í–°–ï–• –ö–≠–®–ï–ô
        (function() {
            console.log('üîÑ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...');
            
            // 1. –£–¥–∞–ª—è–µ–º –í–°–ï Service Workers
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(function(registrations) {
                    for(let registration of registrations) {
                        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º SW:', registration.scope);
                        registration.unregister();
                    }
                });
            }
            
            // 2. –û—á–∏—â–∞–µ–º –í–°–ï –∫—ç—à–∏
            if ('caches' in window) {
                caches.keys().then(function(cacheNames) {
                    cacheNames.forEach(function(cacheName) {
                        console.log('üóëÔ∏è –£–¥–∞–ª—è–µ–º –∫—ç—à:', cacheName);
                        caches.delete(cacheName);
                    });
                });
            }
            
            // 3. –û—á–∏—â–∞–µ–º localStorage –∏ sessionStorage
            localStorage.clear();
            sessionStorage.clear();
            
            console.log('‚úÖ –í—Å–µ –∫—ç—à–∏ –æ—á–∏—â–µ–Ω—ã');
            
            // 4. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —á–µ—Ä–µ–∑ 1 —Å–µ–∫—É–Ω–¥—É
            setTimeout(function() {
                console.log('üîÑ –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É...');
                window.location.reload(true); // true = –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫—ç—à
            }, 1000);
            
        })();
        
        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ Service Worker –ü–û–°–õ–ï –æ—á–∏—Å—Ç–∫–∏
        setTimeout(function() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('./sw.js?v=' + Date.now())
                    .then(function(registration) {
                        console.log('‚úÖ –ù–æ–≤—ã–π SW –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('‚ùå –û—à–∏–±–∫–∞ SW:', error);
                    });
            }
        }, 2000);
        
        // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ fetch –∑–∞–ø—Ä–æ—Å–æ–≤
        if (window.fetch) {
            const originalFetch = window.fetch;
            window.fetch = function(...args) {
                const url = args[0];
                if (typeof url === 'string' && 
                    (url.includes('.css') || url.includes('.js') || url.includes('.json'))) {
                    args[0] = url + (url.includes('?') ? '&' : '?') + '_=' + Date.now();
                }
                return originalFetch.apply(this, args);
            };
        }
    </script>
</body>
</html>